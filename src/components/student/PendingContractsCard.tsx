import React, { useState, useEffect } from 'react';\nimport { motion } from 'framer-motion';\nimport {\n  DocumentCheckIcon,\n  ClockIcon,\n  UserIcon,\n  EyeIcon\n} from '@heroicons/react/24/outline';\n\nimport { useContractStore } from '../../store/contract.store';\nimport ContractReviewModal from './ContractReviewModal';\nimport { Contract } from '../../types/contract.types';\n\ninterface PendingContractsCardProps {\n  className?: string;\n}\n\nconst PendingContractsCard: React.FC<PendingContractsCardProps> = ({ className = '' }) => {\n  const { pendingContracts, getPendingContracts, isLoading } = useContractStore();\n  const [selectedContract, setSelectedContract] = useState<Contract | null>(null);\n\n  useEffect(() => {\n    getPendingContracts();\n  }, []);\n\n  const formatCurrency = (amount: number) => {\n    return new Intl.NumberFormat('vi-VN', {\n      style: 'currency',\n      currency: 'VND'\n    }).format(amount);\n  };\n\n  const getTimeRemaining = (expiryDate: string) => {\n    const now = new Date();\n    const expiry = new Date(expiryDate);\n    const diffMs = expiry.getTime() - now.getTime();\n    \n    if (diffMs <= 0) return 'Đã hết hạn';\n    \n    const diffHours = Math.floor(diffMs / (1000 * 60 * 60));\n    const diffDays = Math.floor(diffHours / 24);\n    \n    if (diffDays > 0) {\n      return `${diffDays} ngày ${diffHours % 24} giờ`;\n    }\n    return `${diffHours} giờ`;\n  };\n\n  const handleContractReviewed = () => {\n    setSelectedContract(null);\n    getPendingContracts(); // Refresh the list\n  };\n\n  if (isLoading) {\n    return (\n      <div className={`bg-white rounded-lg shadow-sm border border-gray-200 p-6 ${className}`}>\n        <div className=\"animate-pulse space-y-4\">\n          <div className=\"h-6 bg-gray-200 rounded w-1/3\"></div>\n          <div className=\"space-y-3\">\n            <div className=\"h-4 bg-gray-200 rounded w-full\"></div>\n            <div className=\"h-4 bg-gray-200 rounded w-2/3\"></div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <>\n      <div className={`bg-white rounded-lg shadow-sm border border-gray-200 ${className}`}>\n        <div className=\"p-6\">\n          <div className=\"flex items-center justify-between mb-6\">\n            <div className=\"flex items-center space-x-2\">\n              <DocumentCheckIcon className=\"w-5 h-5 text-orange-600\" />\n              <h3 className=\"text-lg font-medium text-gray-900\">\n                Hợp đồng chờ duyệt\n              </h3>\n              {pendingContracts.length > 0 && (\n                <span className=\"bg-orange-100 text-orange-800 text-sm font-medium px-2.5 py-0.5 rounded-full\">\n                  {pendingContracts.length}\n                </span>\n              )}\n            </div>\n          </div>\n\n          {pendingContracts.length === 0 ? (\n            <div className=\"text-center py-8\">\n              <DocumentCheckIcon className=\"w-12 h-12 text-gray-300 mx-auto mb-3\" />\n              <p className=\"text-gray-500 text-sm\">\n                Bạn không có hợp đồng nào cần duyệt\n              </p>\n            </div>\n          ) : (\n            <div className=\"space-y-4\">\n              {pendingContracts.map((contract) => (\n                <motion.div\n                  key={contract.id}\n                  initial={{ opacity: 0, y: 20 }}\n                  animate={{ opacity: 1, y: 0 }}\n                  className=\"border border-gray-200 rounded-lg p-4 hover:border-orange-300 transition-colors\"\n                >\n                  <div className=\"flex items-start justify-between\">\n                    <div className=\"flex-1 min-w-0\">\n                      <h4 className=\"text-sm font-medium text-gray-900 truncate\">\n                        {contract.title}\n                      </h4>\n                      <div className=\"flex items-center space-x-4 mt-2 text-xs text-gray-500\">\n                        <div className=\"flex items-center space-x-1\">\n                          <UserIcon className=\"w-3 h-3\" />\n                          <span>{contract.tutor?.full_name}</span>\n                        </div>\n                        <div className=\"flex items-center space-x-1\">\n                          <ClockIcon className=\"w-3 h-3\" />\n                          <span>Hết hạn: {getTimeRemaining(contract.expiresAt)}</span>\n                        </div>\n                      </div>\n                      <div className=\"flex items-center justify-between mt-3\">\n                        <div className=\"text-sm\">\n                          <span className=\"text-gray-500\">{contract.totalSessions} buổi × </span>\n                          <span className=\"font-medium text-green-600\">\n                            {formatCurrency(contract.pricePerSession)}\n                          </span>\n                        </div>\n                        <div className=\"text-lg font-bold text-green-600\">\n                          {formatCurrency(contract.totalAmount)}\n                        </div>\n                      </div>\n                    </div>\n                    \n                    <button\n                      onClick={() => setSelectedContract(contract)}\n                      className=\"ml-4 flex items-center space-x-2 px-3 py-2 bg-orange-600 text-white text-sm font-medium rounded-md hover:bg-orange-700 focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 transition-colors\"\n                    >\n                      <EyeIcon className=\"w-4 h-4\" />\n                      <span>Xem xét</span>\n                    </button>\n                  </div>\n                  \n                  {/* Urgency indicator */}\n                  {(() => {\n                    const timeLeft = new Date(contract.expiresAt).getTime() - Date.now();\n                    const hoursLeft = timeLeft / (1000 * 60 * 60);\n                    \n                    if (hoursLeft <= 24) {\n                      return (\n                        <div className=\"mt-3 flex items-center space-x-2 text-xs text-red-600 bg-red-50 px-2 py-1 rounded\">\n                          <ClockIcon className=\"w-3 h-3\" />\n                          <span className=\"font-medium\">Sắp hết hạn!</span>\n                        </div>\n                      );\n                    }\n                    return null;\n                  })()\n                  }\n                </motion.div>\n              ))}\n              \n              {pendingContracts.length > 3 && (\n                <div className=\"text-center pt-2\">\n                  <button className=\"text-sm text-orange-600 hover:text-orange-700 font-medium\">\n                    Xem tất cả ({pendingContracts.length})\n                  </button>\n                </div>\n              )}\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Contract Review Modal */}\n      {selectedContract && (\n        <ContractReviewModal\n          contract={selectedContract}\n          onClose={() => setSelectedContract(null)}\n          onSuccess={handleContractReviewed}\n        />\n      )}\n    </>\n  );\n};\n\nexport default PendingContractsCard;